/*
Code for Import https://scriptui.joonas.me â€” (Triple click to select): 
{"activeId":42,"items":{"item-0":{"id":0,"type":"Dialog","parentId":false,"style":{"enabled":true,"varName":null,"windowType":"Dialog","creationProps":{"su1PanelCoordinates":false,"maximizeButton":false,"minimizeButton":false,"independent":false,"closeButton":true,"borderless":false,"resizeable":false},"text":"Dialog","preferredSize":[0,0],"margins":16,"orientation":"column","spacing":10,"alignChildren":["right","top"]}},"item-1":{"id":1,"type":"Group","parentId":5,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["right","bottom"],"alignment":null}},"item-2":{"id":2,"type":"Group","parentId":5,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null},"hidden":true},"item-3":{"id":3,"type":"StaticText","parentId":1,"style":{"enabled":true,"varName":null,"creationProps":{"truncate":"none","multiline":false,"scrolling":false},"softWrap":false,"text":"Frequency :","justify":"right","preferredSize":[75,0],"alignment":"center","helpTip":null}},"item-4":{"id":4,"type":"EditText","parentId":1,"style":{"enabled":true,"varName":"frequencyHalft","creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"65","justify":"left","preferredSize":[60,0],"alignment":null,"helpTip":null}},"item-5":{"id":5,"type":"Panel","parentId":40,"style":{"enabled":true,"varName":null,"creationProps":{"borderStyle":"etched","su1PanelCoordinates":false},"text":"Halftone Screen","preferredSize":[0,0],"margins":10,"orientation":"column","spacing":10,"alignChildren":["left","top"],"alignment":null}},"item-6":{"id":6,"type":"StaticText","parentId":2,"style":{"enabled":true,"varName":null,"creationProps":{"truncate":"none","multiline":false,"scrolling":false},"softWrap":false,"text":"Angle :","justify":"right","preferredSize":[75,0],"alignment":null,"helpTip":null}},"item-7":{"id":7,"type":"StaticText","parentId":12,"style":{"enabled":true,"varName":null,"creationProps":{"truncate":"none","multiline":false,"scrolling":false},"softWrap":false,"text":"Shape :","justify":"right","preferredSize":[75,0],"alignment":null,"helpTip":null}},"item-8":{"id":8,"type":"EditText","parentId":2,"style":{"enabled":true,"varName":null,"creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"45","justify":"left","preferredSize":[60,0],"alignment":null,"helpTip":null}},"item-10":{"id":10,"type":"DropDownList","parentId":1,"style":{"enabled":true,"varName":null,"text":"DropDownList","listItems":"Lines/Inch, Lines/Centimeter","preferredSize":[0,0],"alignment":null,"selection":0,"helpTip":null}},"item-12":{"id":12,"type":"Group","parentId":5,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null}},"item-13":{"id":13,"type":"StaticText","parentId":2,"style":{"enabled":true,"varName":null,"creationProps":{"truncate":"none","multiline":false,"scrolling":false},"softWrap":false,"text":"Degrees","justify":"left","preferredSize":[0,0],"alignment":"fill","helpTip":null}},"item-14":{"id":14,"type":"DropDownList","parentId":12,"style":{"enabled":true,"varName":"shapeHalft","text":"DropDownList","listItems":"Round,Diamond,Elips,Line,Square,Cross","preferredSize":[0,0],"alignment":"top","selection":1,"helpTip":null}},"item-15":{"id":15,"type":"Panel","parentId":20,"style":{"enabled":true,"varName":null,"creationProps":{"borderStyle":"etched","su1PanelCoordinates":false},"text":"Channel","preferredSize":[0,0],"margins":[30,12,30,12],"orientation":"column","spacing":10,"alignChildren":["left","top"],"alignment":null}},"item-20":{"id":20,"type":"Group","parentId":0,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null}},"item-21":{"id":21,"type":"Group","parentId":40,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["right","center"],"alignment":null}},"item-22":{"id":22,"type":"Button","parentId":21,"style":{"enabled":true,"varName":"cancelButton","text":"Cancel","justify":"center","preferredSize":[0,0],"alignment":null,"helpTip":null}},"item-23":{"id":23,"type":"Button","parentId":21,"style":{"enabled":true,"varName":"applyButton","text":"OK","justify":"center","preferredSize":[0,0],"alignment":null,"helpTip":null}},"item-24":{"id":24,"type":"Panel","parentId":40,"style":{"enabled":true,"varName":null,"creationProps":{"borderStyle":"etched","su1PanelCoordinates":false},"text":"Location","preferredSize":[0,0],"margins":10,"orientation":"row","spacing":10,"alignChildren":["right","top"],"alignment":"fill"}},"item-25":{"id":25,"type":"Button","parentId":24,"style":{"enabled":true,"varName":"locationButton","text":"Browse","justify":"center","preferredSize":[0,0],"alignment":"fill","helpTip":null}},"item-26":{"id":26,"type":"EditText","parentId":24,"style":{"enabled":true,"varName":"fileLocation","creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"~/Desktop","justify":"left","preferredSize":[207,0],"alignment":"fill","helpTip":null}},"item-29":{"id":29,"type":"Group","parentId":15,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null}},"item-30":{"id":30,"type":"Checkbox","parentId":29,"style":{"enabled":true,"varName":null,"text":"Magenta","preferredSize":[70,0],"alignment":null,"helpTip":null}},"item-33":{"id":33,"type":"EditText","parentId":29,"style":{"enabled":true,"varName":"magentaAngle","creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"35","justify":"left","preferredSize":[0,0],"alignment":null,"helpTip":null}},"item-34":{"id":34,"type":"Group","parentId":15,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null}},"item-35":{"id":35,"type":"Checkbox","parentId":34,"style":{"enabled":true,"varName":null,"text":"Yellow","preferredSize":[70,0],"alignment":null,"helpTip":null}},"item-36":{"id":36,"type":"EditText","parentId":34,"style":{"enabled":true,"varName":"yelloAngle","creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"00","justify":"left","preferredSize":[0,0],"alignment":null,"helpTip":null}},"item-37":{"id":37,"type":"Group","parentId":15,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null}},"item-38":{"id":38,"type":"Checkbox","parentId":37,"style":{"enabled":true,"varName":null,"text":"Black","preferredSize":[70,0],"alignment":null,"helpTip":null}},"item-39":{"id":39,"type":"EditText","parentId":37,"style":{"enabled":true,"varName":"blackAngle","creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"45","justify":"left","preferredSize":[0,0],"alignment":null,"helpTip":null}},"item-40":{"id":40,"type":"Group","parentId":20,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"column","spacing":10,"alignChildren":["fill","top"],"alignment":"top"}},"item-41":{"id":41,"type":"Group","parentId":15,"style":{"enabled":true,"varName":null,"preferredSize":[0,0],"margins":0,"orientation":"row","spacing":10,"alignChildren":["left","center"],"alignment":null}},"item-42":{"id":42,"type":"Checkbox","parentId":41,"style":{"enabled":true,"varName":null,"text":"Cyan","preferredSize":[70,0],"alignment":null,"helpTip":null}},"item-43":{"id":43,"type":"EditText","parentId":41,"style":{"enabled":true,"varName":"cyanAngle","creationProps":{"noecho":false,"readonly":false,"multiline":false,"scrollable":false,"borderless":false,"enterKeySignalsOnChange":false},"softWrap":false,"text":"15","justify":"left","preferredSize":[0,0],"alignment":null,"helpTip":null}}},"order":[0,20,15,41,42,43,29,30,33,34,35,36,37,38,39,40,5,1,3,4,10,2,6,8,13,12,7,14,24,26,25,21,22,23],"settings":{"importJSON":true,"indentSize":false,"cepExport":false,"includeCSSJS":true,"showDialog":true,"functionWrapper":false,"afterEffectsDockable":false,"itemReferenceList":"None"}}
*/

// DIALOG
// ======
var dialog = new Window("dialog");
dialog.text = "Dialog";
dialog.orientation = "column";
dialog.alignChildren = ["right", "top"];
dialog.spacing = 10;
dialog.margins = 16;

// GROUP1
// ======
var group1 = dialog.add("group", undefined, {
    name: "group1"
});
group1.orientation = "row";
group1.alignChildren = ["left", "center"];
group1.spacing = 10;
group1.margins = 0;

// PANEL1
// ======
var panel1 = group1.add("panel", undefined, undefined, {
    name: "panel1"
});
panel1.text = "Channel";
panel1.orientation = "column";
panel1.alignChildren = ["left", "top"];
panel1.spacing = 10;
panel1.margins = [12, 30, 12, 30];

// GROUP2
// ======
var group2 = panel1.add("group", undefined, {
    name: "group2"
});
group2.orientation = "row";
group2.alignChildren = ["left", "center"];
group2.spacing = 10;
group2.margins = 0;

var checkbox1 = group2.add("checkbox", undefined, undefined, {
    name: "checkbox1"
});
checkbox1.value = true;
checkbox1.text = "Cyan";
checkbox1.preferredSize.width = 70;

var cyanAngle = group2.add('edittext {properties: {name: "cyanAngle"}}');
cyanAngle.text = "108";

// GROUP3
// ======
var group3 = panel1.add("group", undefined, {
    name: "group3"
});
group3.orientation = "row";
group3.alignChildren = ["left", "center"];
group3.spacing = 10;
group3.margins = 0;

var checkbox2 = group3.add("checkbox", undefined, undefined, {
    name: "checkbox2"
});
checkbox2.value = true;
checkbox2.text = "Magenta";
checkbox2.preferredSize.width = 70;

var magentaAngle = group3.add('edittext {properties: {name: "magentaAngle"}}');
magentaAngle.text = "162";

// GROUP4
// ======
var group4 = panel1.add("group", undefined, {
    name: "group4"
});
group4.orientation = "row";
group4.alignChildren = ["left", "center"];
group4.spacing = 10;
group4.margins = 0;

var checkbox3 = group4.add("checkbox", undefined, undefined, {
    name: "checkbox3"
});
checkbox3.value = true;
checkbox3.text = "Yellow";
checkbox3.preferredSize.width = 70;

var yelloAngle = group4.add('edittext {properties: {name: "yelloAngle"}}');
yelloAngle.text = "90";

// GROUP5
// ======
var group5 = panel1.add("group", undefined, {
    name: "group5"
});
group5.orientation = "row";
group5.alignChildren = ["left", "center"];
group5.spacing = 10;
group5.margins = 0;

var checkbox4 = group5.add("checkbox", undefined, undefined, {
    name: "checkbox4"
});
checkbox4.value = true;
checkbox4.text = "Black";
checkbox4.preferredSize.width = 70;

var blackAngle = group5.add('edittext {properties: {name: "blackAngle"}}');
blackAngle.text = "45";

// GROUP6
// ======
var group6 = group1.add("group", undefined, {
    name: "group6"
});
group6.orientation = "column";
group6.alignChildren = ["fill", "top"];
group6.spacing = 10;
group6.margins = 0;
group6.alignment = ["left", "top"];

// PANEL2
// ======
var panel2 = group6.add("panel", undefined, undefined, {
    name: "panel2"
});
panel2.text = "Halftone Screen";
panel2.orientation = "column";
panel2.alignChildren = ["left", "top"];
panel2.spacing = 10;
panel2.margins = 10;

// GROUP7
// ======
var group7 = panel2.add("group", undefined, {
    name: "group7"
});
group7.orientation = "row";
group7.alignChildren = ["right", "bottom"];
group7.spacing = 10;
group7.margins = 0;

var statictext1 = group7.add("statictext", undefined, undefined, {
    name: "statictext1"
});
statictext1.text = "Frequency :";
statictext1.preferredSize.width = 75;
statictext1.justify = "right";
statictext1.alignment = ["right", "center"];

var frequencyHalft = group7.add('edittext {properties: {name: "frequencyHalft"}}');
frequencyHalft.text = "65";
frequencyHalft.preferredSize.width = 60;

var dropdown1_array = ["Lines/Inch", "Lines/Centimeter"];
var dropdown1 = group7.add("dropdownlist", undefined, undefined, {
    name: "dropdown1",
    items: dropdown1_array
});
dropdown1.selection = 0;


// GROUP9
// ======
var group9 = panel2.add("group", undefined, {
    name: "group9"
});
group9.orientation = "row";
group9.alignChildren = ["left", "center"];
group9.spacing = 10;
group9.margins = 0;

var statictext4 = group9.add("statictext", undefined, undefined, {
    name: "statictext4"
});
statictext4.text = "Shape :";
statictext4.preferredSize.width = 75;
statictext4.justify = "right";

var shapeHalft_array = ["Round", "Diamond", "Elips", "Line", "Square", "Cross"];
var shapeHalft = group9.add("dropdownlist", undefined, undefined, {
    name: "shapeHalft",
    items: shapeHalft_array
});
shapeHalft.selection = 0;
shapeHalft.alignment = ["left", "top"];

// PANEL3
// ======
var panel3 = group6.add("panel", undefined, undefined, {
    name: "panel3"
});
panel3.text = "Location";
panel3.orientation = "row";
panel3.alignChildren = ["right", "top"];
panel3.spacing = 10;
panel3.margins = 10;
panel3.alignment = ["fill", "top"];

var fileLocation = panel3.add('edittext {properties: {name: "fileLocation"}}');
fileLocation.text = "~/Desktop";
fileLocation.preferredSize.width = 207;
fileLocation.alignment = ["right", "fill"];

var locationButton = panel3.add("button", undefined, undefined, {
    name: "locationButton"
});
locationButton.text = "Browse";
locationButton.alignment = ["right", "fill"];
locationButton.onClick = function() {
    var outputFolder = Folder.selectDialog("select output folder");
    fileLocation.text = outputFolder;
}
// GROUP10
// =======
var group10 = group6.add("group", undefined, {
    name: "group10"
});
group10.orientation = "row";
group10.alignChildren = ["right", "center"];
group10.spacing = 10;
group10.margins = 0;

var cancelButton = group10.add("button", undefined, undefined, {
    name: "cancelButton"
});
cancelButton.text = "Cancel";

var applyButton = group10.add("button", undefined, undefined, {
    name: "applyButton"
});
applyButton.text = "OK";


applyButton.onClick = function() {
    rastersparasi()
}
dialog.show();

function rastersparasi() {
    var jpegoptions = new JPEGSaveOptions()
    jpegoptions.quality = 1;
    var docRef = activeDocument
    var myLocation = fileLocation.text
    docRef.changeMode(ChangeMode.CMYK);
    var myChannel = docRef.activeChannels
    try {
        var savedState = docRef.activeHistoryState;
        var nameChannel = ["cyan", "magenta", "yellow", "black"]
        var myAngle = [cyanAngle.text, magentaAngle.text, yelloAngle.text, blackAngle.text]
        var usedChannel = [checkbox1.value, checkbox2.value, checkbox3.value, checkbox4.value]
        // var channelUse = []

        for (var i = 0, len = myChannel.length; i < len; i++) {
            if (usedChannel[i]) {
                docRef.activeChannels = [myChannel[i]]
                var bitSaveOptions = new BitmapConversionOptions();
                bitSaveOptions.method = BitmapConversionType.HALFTONESCREEN;
                bitSaveOptions.angle = myAngle[i];
                bitSaveOptions.frequency = frequencyHalft.text;
                bitSaveOptions.resolution = 300;
                bitSaveOptions.shape = BitmapHalfToneType.ROUND;
                docRef.changeMode(ChangeMode.BITMAP, bitSaveOptions)
                docRef.saveAs(new File(myLocation + "/" + docRef.name.substr(0, docRef.name.lastIndexOf('.')) + nameChannel[i] + ".psd"), undefined, true);
                docRef.activeHistoryState = savedState
            } 
        };
        dialog.close();
    } catch (err) {
        alert(err)
    }

}